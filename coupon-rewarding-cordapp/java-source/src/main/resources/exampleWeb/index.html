<!DOCTYPE html>
<html lang="en">
<head>
    <title>Zaggers</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript">
         function getCoupons() {
                var port = getPortNumber();
            var xmlHttpReq = new XMLHttpRequest();
            xmlHttpReq.onreadystatechange = function() {
                if(this.readyState == 4) {
                    document.getElementById("coupons").innerHTML = this.responseText;
                }
            };
           xmlHttpReq.open("GET", "http://localhost:" + port + "/api/rewards/coupon-amount/", true);
            xmlHttpReq.send();
         }

          function getPortNumber() {

            var url = window.location.href;
            var splitUrl = url.split("/");
            var urlArray = splitUrl[2];
            var portSplit = urlArray.split(":");
           var port  = portSplit[1].toString()
            return port;
          }

         function genCoupon() {
             $("#loading").show();
             var port = getPortNumber();
             xmlHttpReq = new XMLHttpRequest();
             xmlHttpReq.open("POST", "http://localhost:" + port +"/api/rewards/coupon-generations/", true);
             xmlHttpReq.onreadystatechange = displayResponse;
             xmlHttpReq.setRequestHeader("Content-Type", "application/json");
             var amount = document.getElementById("amt").value;
             var username = document.getElementById("username").value;
             var party = document.getElementById("party").value;
             var couponName = document.getElementById("coupon-name").value;
             var data = JSON.stringify({"partyName": party, "value": amount, "userName": username, "couponName": couponName});
             xmlHttpReq.send(data);
         }

         function displayResponse() {

         if(xmlHttpReq.readyState == 4  ) {
            alert(xmlHttpReq.responseText);
         document.getElementById("result").innerHTML = xmlHttpReq.responseText;
         getCoupons();
          $('#refresh').removeClass('hide');

         }

         }


      </script>
    <style>
         body {
         background-color: white;
         }

         div#result {
            color:Red;
            font-size: 15px;
        }

         table.background { background: url("simple.jpg") no-repeat; }
         table, th, td {
         border-collapse: collapse;
         }
         th, td {
         padding: 15px;
         text-align: left;
         }
         h5 {
         color: Red;
         font-family : fantasy;
         }

          h1 {
            font-size : 36px;
            font-family : fantasy;
            color: Black;
         }

      </style>
</head>
<body>
<center>
        <h1>Welcome To Zaggle</h1>
        <h5>why haggle when you can zaggle</h5>
        <img src="zaggle.jpg" alt="zaggle" width="100" height="64">
    <br/>
    <table class="background">
        <tr>
            <td><label for="amt" class="text-white">Coupon Amount : </label></td>
            <td><input type ="text" class="form-control input-sm" name="amt" id ="amt" placeholder="Enter Amount"></td>
        </tr>
        <tr>
            <td><label for="coupon-name" class="text-white">Coupon Name : </label></td>
            <td><input type ="text" class="form-control input-sm" name="coupon-name" id ="coupon-name" placeholder="Enter Coupon Name"></td>
        </tr>
        <tr>
            <td><label for="party" class="text-white">Vendor name : </label></td>
            <td>
                <select class="form-control" name="party" id ="party" placeholder="Enter vendor name">
                    <option value="">select vendor</option>
                    <option value="O=AmazonPay, L=New York, C=US">AmazonPay</option>
                    <option value="O=PhonePay, L=Paris, C=FR">PhonePay</option>
                </select>
            </td>
        </tr>
        <tr>
            <td><label for="username" class="text-white">User name : </label></td>
            <td><input type ="email" class="form-control input-sm" name="username" id ="username" placeholder="Enter user name"></td>
        </tr>
    </table>
    <br/>
    <input type ="button" class="btn btn-info" data-toggle="collapse" data-target="#result" name = "coupon" id ="coupon" value = "Generate coupon" onclick ="genCoupon();">
</center>
<br/>
<br/>
<center>
    <div id="result" class="collapse" style="background-color:white"></div>
    <br/>
    <div id ="coupons">
    </div>
    <input type ="button" class="btn hide"  name = "refresh" id ="refresh" value = "refresh" onclick ="getCoupons();">
</center>
</body>
</html>